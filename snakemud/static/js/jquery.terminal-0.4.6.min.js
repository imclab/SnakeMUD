/*

 |       __ _____                     ________                              __
 |      / // _  /__ __ _____ ___ __ _/__  ___/__ ___ ______ __ __  __ ___  / /
 |  __ / // // // // // _  // _// // / / // _  // _//     // //  \/ // _ \/ /
 | /  / // // // // // ___// / / // / / // ___// / / / / // // /\  // // / /__
 | \___//____ \\___//____//_/ _\_  / /_//____//_/ /_/ /_//_//_/ /_/ \__\_\___/
 |           \/              /____/                              version 0.4.6
 http://terminal.jcubic.pl

 Licensed under GNU LGPL Version 3 license
 Copyright (c) 2011 Jakub Jankiewicz <http://jcubic.pl>

 Includes:

 Storage plugin Distributed under the MIT License
 Copyright (c) 2010 Dave Schindler

 LiveQuery plugin Dual MIT and GPL
 Copyright (c) 2008 Brandon Aaron (http://brandonaaron.net)

 jQuery Timers licenced with the WTFPL
 <http://jquery.offput.ca/every/>

 Date: Sun, 08 Jan 2012 19:25:00 +0000
*/
Array.prototype.has=function(g){for(var A=this.length;A--;)if(this[A]==g)return true;return false};function get_stack(g){return g?[g.toString().match(/.*\n.*\n/)].concat(get_stack(g.caller)):[]}
(function(g,A){function Z(a,d){var e;if(typeof a==="string"&&typeof d==="string"){localStorage[a]=d;return true}else if(typeof a==="object"&&typeof d==="undefined"){for(e in a)if(a.hasOwnProperty(e))localStorage[e]=a[e];return true}return false}function W(a,d){var e,i;e=new Date;e.setTime(e.getTime()+31536E6);e="; expires="+e.toGMTString();if(typeof a==="string"&&typeof d==="string"){document.cookie=a+"="+d+e+"; path=/";return true}else if(typeof a==="object"&&typeof d==="undefined"){for(i in a)if(a.hasOwnProperty(i))document.cookie=
i+"="+a[i]+e+"; path=/";return true}return false}function $(a){return localStorage[a]}function aa(a){var d,e,i;a+="=";d=document.cookie.split(";");for(e=0;e<d.length;e++){for(i=d[e];i.charAt(0)===" ";)i=i.substring(1,i.length);if(i.indexOf(a)===0)return i.substring(a.length,i.length)}return null}function ba(a){return delete localStorage[a]}function ca(a){return W(a,"",-1)}function V(a,d){var e=[],i=a.length;if(i<d)return[a];for(var h=0;h<i;h+=d)e.push(a.substring(h,h+d));return e}function G(a){if(typeof a==
"string"){a=a.replace(/&(?!#[0-9]*;)/g,"&amp;");a=a.replace(/</g,"&lt;").replace(/>/g,"&gt;");a=a.replace(/\n/g,"<br/>");a=a.replace(/ /g,"&nbsp;");a=a.replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;");var d=a.split(da);if(d.length>1)a=g.map(d,function(e){return e===""?e:e[0]=="["?e.replace(ea,function(i,h,t,y,C){if(C==="")return"<span>&nbsp;</span>";i="";if(h.indexOf("b")!=-1)i+="font-weight:bold;";if(h.indexOf("u")!=-1)i+="text-decoration:underline;";if(h.indexOf("i")!=-1)i+="font-style:italic; ";if(t.match(X))i+=
"color:"+t+";";if(y.match(X))i+="background-color:"+y;return a='<span style="'+i+'">'+C+"</span>"}):"<span>"+e+"</span>"}).join("");return a}else return""}function Y(a){var d=a instanceof Array?a:a?[a]:[],e=0;g.extend(this,{left:function(){if(e===0)e=d.length-1;else--e;return d[e]},right:function(){if(e==d.length-1)e=0;else++e;return d[e]},current:function(){return d[e]},data:function(){return d},length:function(){return d.length},reset:function(){e=0},append:function(i){d.push(i);this.reset()}})}
function fa(a){var d=a?[a]:[];g.extend(this,{size:function(){return d.length},pop:function(){if(d.length===0)return null;else{var e=d[d.length-1];d=d.slice(0,d.length-1);return e}},push:function(e){d=d.concat([e]);return e},top:function(){return d.length>0?d[d.length-1]:null}})}function ga(a){var d=true;if(typeof a==="string"&&a!=="")a+="_";var e=g.Storage.get(a+"commands"),i=new Y(e?eval("("+e+")"):[""]);g.extend(this,{append:function(h){if(d&&i.current()!=h){i.append(h);g.Storage.set(a+"commands",
g.json_stringify(i.data()))}},data:function(){return i.data()},next:function(){return i.right()},last:function(){i.reset()},previous:function(){return i.left()},clear:function(){i=new Y;g.Storage.remove(a+"commands")},enable:function(){d=true},disable:function(){d=false}})}g.extend(g.fn,{livequery:function(a,d,e){var i=this,h;if(g.isFunction(a)){e=d;d=a;a=A}g.each(g.livequery.queries,function(t,y){if(i.selector==y.selector&&i.context==y.context&&a==y.type&&(!d||d.$lqguid==y.fn.$lqguid)&&(!e||e.$lqguid==
y.fn2.$lqguid))return(h=y)&&false});h=h||new g.livequery(this.selector,this.context,a,d,e);h.stopped=false;h.run();return this},expire:function(a,d,e){var i=this;if(g.isFunction(a)){e=d;d=a;a=A}g.each(g.livequery.queries,function(h,t){if(i.selector==t.selector&&i.context==t.context&&(!a||a==t.type)&&(!d||d.$lqguid==t.fn.$lqguid)&&(!e||e.$lqguid==t.fn2.$lqguid)&&!this.stopped)g.livequery.stop(t.id)});return this}});g.livequery=function(a,d,e,i,h){this.selector=a;this.context=d||document;this.type=
e;this.fn=i;this.fn2=h;this.elements=[];this.stopped=false;this.id=g.livequery.queries.push(this)-1;i.$lqguid=i.$lqguid||g.livequery.guid++;if(h)h.$lqguid=h.$lqguid||g.livequery.guid++;return this};g.livequery.prototype={stop:function(){var a=this;if(this.type)this.elements.unbind(this.type,this.fn);else this.fn2&&this.elements.each(function(d,e){a.fn2.apply(e)});this.elements=[];this.stopped=true},run:function(){if(!this.stopped){var a=this,d=this.elements,e=g(this.selector,this.context),i=e.not(d);
this.elements=e;if(this.type){i.bind(this.type,this.fn);d.length>0&&g.each(d,function(h,t){g.inArray(t,e)<0&&g.event.remove(t,a.type,a.fn)})}else{i.each(function(){a.fn.apply(this)});this.fn2&&d.length>0&&g.each(d,function(h,t){g.inArray(t,e)<0&&a.fn2.apply(t)})}}}};g.extend(g.livequery,{guid:0,queries:[],queue:[],running:false,timeout:null,checkQueue:function(){if(g.livequery.running&&g.livequery.queue.length)for(var a=g.livequery.queue.length;a--;)g.livequery.queries[g.livequery.queue.shift()].run()},
pause:function(){g.livequery.running=false},play:function(){g.livequery.running=true;g.livequery.run()},registerPlugin:function(){g.each(arguments,function(a,d){if(g.fn[d]){var e=g.fn[d];g.fn[d]=function(){var i=e.apply(this,arguments);g.livequery.run();return i}}})},run:function(a){if(a!=A)g.inArray(a,g.livequery.queue)<0&&g.livequery.queue.push(a);else g.each(g.livequery.queries,function(d){g.inArray(d,g.livequery.queue)<0&&g.livequery.queue.push(d)});g.livequery.timeout&&clearTimeout(g.livequery.timeout);
g.livequery.timeout=setTimeout(g.livequery.checkQueue,20)},stop:function(a){a!=A?g.livequery.queries[a].stop():g.each(g.livequery.queries,function(d){g.livequery.queries[d].stop()})}});g.livequery.registerPlugin("append","prepend","after","before","wrap","attr","removeAttr","addClass","removeClass","toggleClass","empty","remove");g(function(){g.livequery.play()});var ha=g.prototype.init;g.prototype.init=function(a,d){var e=ha.apply(this,arguments);if(a&&a.selector){e.context=a.context;e.selector=
a.selector}if(typeof a=="string"){e.context=d||document;e.selector=a}return e};g.prototype.init.prototype=g.prototype;var S=typeof window.localStorage!=="undefined";g.extend({Storage:{set:S?Z:W,get:S?$:aa,remove:S?ba:ca}});jQuery.fn.extend({everyTime:function(a,d,e,i,h){return this.each(function(){jQuery.timer.add(this,a,d,e,i,h)})},oneTime:function(a,d,e){return this.each(function(){jQuery.timer.add(this,a,d,e,1)})},stopTime:function(a,d){return this.each(function(){jQuery.timer.remove(this,a,d)})}});
jQuery.extend({timer:{guid:1,global:{},regex:/^([0-9]+)\s*(.*s)?$/,powers:{ms:1,cs:10,ds:100,s:1E3,das:1E4,hs:1E5,ks:1E6},timeParse:function(a){if(a==A||a===null)return null;var d=this.regex.exec(jQuery.trim(a.toString()));return d[2]?parseInt(d[1],10)*(this.powers[d[2]]||1):a},add:function(a,d,e,i,h,t){var y=0;if(jQuery.isFunction(e)){h||(h=i);i=e;e=d}d=jQuery.timer.timeParse(d);if(!(typeof d!="number"||isNaN(d)||d<=0)){if(h&&h.constructor!=Number){t=!!h;h=0}h=h||0;t=t||false;if(!a.$timers)a.$timers=
{};a.$timers[e]||(a.$timers[e]={});i.$timerID=i.$timerID||this.guid++;var C=function(){if(!(t&&this.inProgress)){this.inProgress=true;if(++y>h&&h!==0||i.call(a,y)===false)jQuery.timer.remove(a,e,i);this.inProgress=false}};C.$timerID=i.$timerID;a.$timers[e][i.$timerID]||(a.$timers[e][i.$timerID]=window.setInterval(C,d));this.global[e]||(this.global[e]=[]);this.global[e].push(a)}},remove:function(a,d,e){var i=a.$timers,h;if(i){if(d){if(i[d]){if(e){if(e.$timerID){window.clearInterval(i[d][e.$timerID]);
delete i[d][e.$timerID]}}else for(e in i[d]){window.clearInterval(i[d][e]);delete i[d][e]}for(h in i[d])break;if(!h){h=null;delete i[d]}}}else for(d in i)this.remove(a,d,e);for(h in i)break;if(!h)a.$timers=null}}}});if(jQuery.browser.msie)jQuery(window).one("unload",function(){var a=jQuery.timer.global,d;for(d in a)for(var e=a[d],i=e.length;--i;)jQuery.timer.remove(e[i],d)});var da=/(\[\[[biu]*;[^;]*;[^\]]*\][^\]\[]*\])/g,ea=/\[\[([biu]*);([^;]*);([^\]]*)\]([^\]\[]*)\]/g,X=/#([0-9A-Fa-f]{3}|[0-9A-Fa-f]{6})/;
g.json_stringify=function(a,d){var e="",i;d=d===A?1:d;switch(typeof a){case "function":e+=a;break;case "boolean":e+=a?"true":"false";break;case "object":if(a===null)e+="null";else if(a instanceof Array){e+="[";var h=a.length;for(i=0;i<h-1;++i)e+=g.json_stringify(a[i],d+1);e+=g.json_stringify(a[h-1],d+1)+"]"}else{e+="{";for(h in a)if(a.hasOwnProperty(h))e+='"'+h+'":'+g.json_stringify(a[h],d+1);e+="}"}break;case "string":h=a;var t={"\\\\":"\\\\",'"':'\\"',"/":"\\/","\\n":"\\n","\\r":"\\r","\\t":"\\t"};
for(i in t)if(t.hasOwnProperty(i))h=h.replace(RegExp(i,"g"),t[i]);e+='"'+h+'"';break;case "number":e+=String(a)}e+=d>1?",":"";if(d==1)e=e.replace(/,([\]}])/g,"$1");return e.replace(/([\[{]),/g,"$1")};g.fn.cmd=function(a){function d(){N.toggleClass("inverted")}function e(f){var r=f.substring(0,y-C-1);f=f.substring(y-C-1);return[r].concat(V(f,y))}function i(){t.focus();h.oneTime(1,function(){h.insert(t.val());t.blur();t.val("")})}var h=this;h.addClass("cmd");h.append('<span class="prompt"></span><span></span><span class="cursor">&nbsp;</span><span></span>');
var t=g("<textarea/>").addClass("clipboard").appendTo(h);a.width&&h.width(a.width);var y,C,T=a.mask||false,m="",n=0,J,K=a.enabled,U,H,N=h.find(".cursor"),c=function(f){function r(s,u){if(u==s.length){D.html(G(s));N.html("&nbsp;");I.html("")}else if(u===0){D.html("");N.html(G(s.slice(0,1)));I.html(G(s.slice(1)))}else{var o=G(s.slice(0,u));D.html(o);o=s.slice(u,u+1);N.html(o==" "?"&nbsp;":G(o));u==s.lenght-1?I.html(""):I.html(G(s.slice(u+1)))}}function L(s){return"<div>"+G(s)+"</div>"}function R(s){var u=
I;g.each(s,function(o,z){u=g(L(z)).insertAfter(u).addClass("clear")})}function l(s){g.each(s,function(u,o){D.before(L(o))})}var D=N.prev(),I=N.next();return function(){var s=T?m.replace(/./g,"*"):m,u;f.find("div").remove();D.html("");if(s.length>y-C-1||s.match(/\n/)){var o,z=s.match(/\t/g),q=z?z.length*3:0;if(z)s=s.replace(/\t/g,"\u0000\u0000\u0000\u0000");if(s.match(/\n/)){var b=s.split("\n"),j=y-C-1;for(u=0;u<b.length-1;++u)b[u]+=" ";if(b[0].length>j){o=[b[0].substring(0,j)];o=o.concat(V(b[0].substring(j),
y))}else o=[b[0]];for(u=1;u<b.length;++u)if(b[u].length>y)o=o.concat(V(b[u],y));else o.push(b[u])}else o=e(s);if(z)o=g.map(o,function(k){return k.replace(/\x00\x00\x00\x00/g,"\t")});j=o[0].length;if(n<j){r(o[0],n);R(o.slice(1))}else if(n==j){D.before(L(o[0]));r(o[1],0);R(o.slice(2))}else{u=o.length;if(n<j){r(o[0],n);R(o.slice(1))}else if(n==j){D.before(L(o[0]));r(o[1],0);R(o.slice(2))}else{z=o.slice(-1)[0];b=s.length-n;s=0;if(b<=z.length){l(o.slice(0,-1));s=z.length==b?0:z.length-b;r(z,s+q)}else if(u==
3){D.before("<div>"+G(o[0])+"</div>");r(o[1],n-j-1);I.after('<div class="clear">'+G(o[2])+"</div>")}else{s=n;for(u=0;u<o.length;++u)if(s>o[u].length)s-=o[u].length;else break;q=o[u];j=u;if(s==q.length){s=0;q=o[++j]}r(q,s);l(o.slice(0,j));R(o.slice(j+1))}}}}else if(s===""){D.html("");N.html("&nbsp;");I.html("")}else r(s,n)}}(h),O=function(){var f=h.find(".prompt");return function(){if(typeof J=="string"){C=J.length;f.html(G(J)+"&nbsp;")}else J(function(r){C=r.length;f.html(G(r)+"&nbsp;")})}}();g.extend(h,
{name:function(f){if(f!==A){U=f;H=new ga(f)}else return U},history:function(){return H},set:function(f,r){if(f!==A){m=f;if(!r)n=m.length;c()}},insert:function(f,r){if(n==m.length)m+=f;else m=n===0?f+m:m.slice(0,n)+f+m.slice(n);r||(n+=f.length);c()},get:function(){return m},commands:function(f){if(f)a.commands=f;else return f},destroy:function(){g(document.documentElement).unbind(".commandline");h.find(".prompt").remove()},prompt:function(f){if(f===A)return J;else{if(typeof f=="string"||typeof f==
"function")J=f;else throw"prompt must be a function or string";O();c()}},position:function(f){if(typeof f=="number"){n=f<0?0:f>m.length?m.length:f;c()}else return n},show:function(){var f=h.show;return function(){f.apply(h,[]);c();O()}}(),resize:function(f){if(f)y=f;else{f=h.width();var r=N.innerWidth();y=Math.floor(f/r)}c()},enable:function(){if(!K){h.everyTime(500,"blink",d);K=true}},isenabled:function(){return K},disable:function(){if(K){h.stopTime("blink",d);h.find(".cursor").removeClass("inverted");
K=false}},mask:function(f){if(typeof f=="boolean"){T=f;c()}else return T}});h.name(a.name||"");J=a.prompt||">";O();if(a.enabled===A||a.enabled===true)h.enable();g(document.documentElement).keypress(function(f){var r;if(f.ctrlKey&&f.which==99)return true;if(a.keypress)r=a.keypress(f);if(r===A||r){if(K)if([38,32,13,0,8].has(f.which)&&f.keyCode!=123&&!(f.which==38&&f.shiftKey))return false;else if(!f.ctrlKey&&!(f.altKey&&f.which==100)){h.insert(String.fromCharCode(f.which));return false}}else return r}).keydown(function(f){if(K){if(a.keydown&&
a.keydown(f)===false)return false;var r;if(f.keyCode==13){H&&m&&H.append(m);H.last();f=m;h.set("");a.commands&&a.commands(f);typeof J=="function"&&O()}else if(f.which==32)h.insert(" ");else if(f.which==8){if(m!==""&&n>0){m=m.slice(0,n-1)+m.slice(n,m.length);--n;c()}}else if(f.which==9&&!(f.ctrlKey||f.altKey))h.insert("\t");else if(f.which==46){if(m!==""&&n<m.length){m=m.slice(0,n)+m.slice(n+1,m.length);c()}return true}else if(H&&f.which==38||f.which==80&&f.ctrlKey)h.set(H.previous());else if(H&&f.which==
40||f.which==78&&f.ctrlKey)h.set(H.next());else if(f.which==37||f.which==66&&f.ctrlKey)if(f.ctrlKey&&f.which!=66){r=n-1;f=0;for(m[r]==" "&&--r;r>0;--r)if(m[r]==" "&&m[r+1]!=" "){f=r+1;break}else if(m[r]=="\n"&&m[r+1]!="\n"){f=r;break}h.position(f)}else{if(n>0){--n;c()}}else if(f.which==39||f.which==70&&f.ctrlKey)if(f.ctrlKey&&f.which!=70){m[n]==" "&&++n;f=m.slice(n).match(/\S[\n\s]{2,}|[\n\s]+\S?/);if(!f||f[0].match(/^\s+$/))n=m.length;else if(f[0][0]!=" ")n+=f.index+1;else{n+=f.index+f[0].length-
1;f[0][f[0].length-1]!=" "&&--n}c()}else{if(n<m.length){++n;c()}}else if(f.which==123)return true;else if(f.which==36)h.position(0);else if(f.which==35)h.position(m.length);else if(f.ctrlKey||f.metaKey)if(f.shiftKey){if(f.which==84)return true}else if(f.which==65)h.position(0);else if(f.which==69)h.position(m.length);else if(f.which==88||f.which==67||f.which==87||f.which==84)return true;else if(f.which==86){i();return true}else if(f.which==75)if(n===0)h.set("");else n!=m.length&&h.set(m.slice(0,n));
else if(f.which==85)h.set("");else{if(f.which==17)return true}else if(f.altKey)f.which==68&&h.set(m.slice(0,n)+m.slice(n).replace(/[^ ]+ |[^ ]+$/,""),true);else return true;return false}});return h};g.jrpc=function(a,d,e,i,h,t){d=g.json_stringify({jsonrpc:"2.0",method:e,params:i,id:d});return g.ajax({url:a,data:d,success:h,error:t,contentType:"application/json",dataType:"json",async:true,cache:false,type:"POST"})};S=/ {13}$/;var ia=[["jQuery Terminal","(c) 2011 jcubic"],["JQuery Terminal Emulator v. 0.4.6",
"Copyright (c) 2011 Jakub Jankiewicz <http://jcubic.pl>".replace(/ *<.*>/,"")],["JQuery Terminal Emulator version version 0.4.6","Copyright (c) 2011 Jakub Jankiewicz <http://jcubic.pl>"],["      _______                 ________                        __","     / / _  /_ ____________ _/__  ___/______________  _____  / /"," __ / / // / // / _  / _/ // / / / _  / _/     / /  \\/ / _ \\/ /","/  / / // / // / ___/ // // / / / ___/ // / / / / /\\  / // / /__","\\___/____ \\\\__/____/_/ \\__ / /_/____/_//_/ /_/ /_/  \\/\\__\\_\\___/",
"         \\/          /____/                                   ".replace(S,"")+"version 0.4.6","Copyright (c) 2011 Jakub Jankiewicz <http://jcubic.pl>"],["      __ _____                     ________                              __","     / // _  /__ __ _____ ___ __ _/__  ___/__ ___ ______ __ __  __ ___  / /"," __ / // // // // // _  // _// // / / // _  // _//     // //  \\/ // _ \\/ /","/  / // // // // // ___// / / // / / // ___// / / / / // // /\\  // // / /__","\\___//____ \\\\___//____//_/ _\\_  / /_//____//_/ /_/ /_//_//_/ /_/ \\__\\_\\___/",
"          \\/              /____/                                          ".replace(S,"")+"version 0.4.6","Copyright (c) 2011 Jakub Jankiewicz <http://jcubic.pl>"]],ja=[],P=new function(a){var d=a?[a]:[],e=0;g.extend(this,{rotate:function(){if(d.length==1)return d[0];else{if(e==d.length-1)e=0;else++e;return d[e]}},length:function(){return d.length},set:function(i){for(var h=d.length;h--;)if(d[h]===i){e=h;return}this.append(i)},front:function(){return d[e]},append:function(i){d.push(i)}})};g.fn.terminal=
function(a,d){function e(){return c.get(0).scrollHeight>c.innerHeight()}function i(){var b=c.find(".cursor").width(),j=Math.floor(c.width()/b);if(e()){var k=c.innerWidth()-c.width();j-=Math.ceil((20-k/2)/(b-1))}return j}function h(b,j){c.error("&#91;"+j+"&#93;: "+(typeof b=="string"?b:b.fileName+": "+b.message));c.pause();typeof b.fileName=="string"&&g.get(b.fileName,function(k){c.resume();var x=b.lineNumber-1;(k=k.split("\n")[x])&&c.error("&#91;"+b.lineNumber+"&#93;: "+k)})}function t(b,j){try{if(typeof j==
"function")j(function(){});else if(typeof j!="string")throw b+" must be string or function";}catch(k){h(k,b.toUpperCase());return false}return true}function y(){var b=c.prop?c.prop("scrollHeight"):c.attr("scrollHeight");c.scrollTop(b)}function C(b){b=typeof b=="string"?b:String(b);var j,k,x;if(b.length>L){j=L;var p=[];k=/(\[\[[biu]*;[^;]*;\][^\]\[]*\]?)/g;x=/(\[\[[biu]*;[^;]*;\])/;b=b.split(/\n/g);for(var v="",w=0,M=b.length;w<M;++w){if(v!=="")if(b[w]===""){p.push(v+"]");continue}else{b[w]=v+b[w];
v=""}for(var B=0,ka=b[w].length;B<ka;B+=j){var E=b[w].substring(B,B+j);if(v!=="")E=v+E;var Q=E.match(k),F=E.match(/\t/g);F=F?F.length:0;if(F>0){F*=3;E=b[w].substring(B,B+j-F);B-=F;console.log(F)}if(Q&&Q.length>0){E=F=0;for(var la=Q.length;E<la;++E){F+=Q[E].match(x)[1].length;if(Q[E][Q[E].length-1]=="]")F+=1}if(v!=="")F-=v.length;E=v+b[w].substring(B,B+j+F);Q=E.match(k);v=Q[Q.length-1];B+=F;if(v[v.length-1]!="]"){E+="]";v=v.match(x)[1]}else v=""}else v="";p.push(E)}}j=g("<div></div>");k=0;for(x=p.length;k<
x;++k)p[k]===""||p[k]=="\r"?j.append("<div>&nbsp;</div>"):g("<div/>").html(G(p[k])).appendTo(j)}else j=g("<div/>").html(G(b));f.append(j);j.width("100%");y();return j}function T(b,j){var k=1,x=function(p,v){j.pause();g.jrpc(b,k++,p,v,function(w){if(w.error)j.error("&#91;RPC&#93; "+w.error.message);else if(typeof w.result=="string")j.echo(w.result);else if(w.result instanceof Array)j.echo(w.result.join(" "));else if(typeof w.result=="object"){var M="",B;for(B in w.result)if(w.result.hasOwnProperty(B))M+=
B+": "+w.result[B]+"\n";j.echo(M)}j.resume()},function(w,M){j.error("&#91;AJAX&#93; "+M+" - Server reponse is: \n"+w.responseText);j.resume()})};return function(p,v){if(p!==""){var w,M;if(p.match(/[^ ]* /)){p=p.split(/ +/);w=p[0];M=p.slice(1)}else{w=p;M=[]}if(!l.login||w=="help")x(w,M);else{var B=v.token();B?x(w,[B].concat(M)):v.error("&#91;AUTH&#93; Access denied (no token)")}}}}function m(b){var j=q.prompt();if(q.mask())b=b.replace(/./g,"*");typeof j=="function"?j(function(k){c.echo(k+" "+b)}):
c.echo(j+" "+b)}function n(b){try{var j=z.top();if(b=="exit"&&l.exit)if(z.size()==1)l.login?K():c.echo("You can exit from main interpeter");else c.pop("exit");else{m(b);b=="clear"&&l.clear?c.clear():j.eval(b,c)}}catch(k){h(k,"USER");c.resume();throw k;}}function J(){var b=null;q.prompt("login:");l.history&&q.history().disable();q.commands(function(j){try{m(j);if(b){q.mask(false);c.pause();if(typeof l.login!="function")throw"Value of login property must be a function";l.login(b,j,function(x){if(x){var p=
l.name;p=p?"_"+p:"";g.Storage.set("token"+p,x);g.Storage.set("login"+p,b);q.commands(n);H()}else{c.error("Wrong password try again");q.prompt("login:");b=null}c.resume();l.history&&q.history().enable()})}else{b=j;q.prompt("password:");q.mask(true)}}catch(k){h(k,"LOGIN",c);throw k;}})}function K(){var b=l.name;b=b?"_"+b:"";g.Storage.remove("token"+b,null);g.Storage.remove("login"+b,null);l.history&&q.history().disable();J()}function U(){var b=z.top(),j="";if(b.name!==A&&b.name!=="")j+=b.name+"_";j+=
r;q.name(j);q.prompt(b.prompt);l.history&&q.history().enable();q.set("");if(typeof b.onStart=="function")b.onStart(c)}function H(){U();if(d.greetings===A)c.echo(c.signature);else d.greetings&&c.echo(d.greetings);if(typeof l.onInit=="function")l.onInit(c)}function N(b){c.oneTime(5,function(){if(s!=e()){c.resize();s=e()}});if(!c.paused()){if(l.keydown&&l.keydown(b,c)===false)return false;if(b.which!=9)I=0;if(b.which==68&&b.ctrlKey){if(l.exit)if(q.get()==="")if(z.size()>1||l.login!==A)c.pop("");else{c.resume();
c.echo("")}else c.set_command("");b.preventDefault()}else if(l.tabcompletion&&b.which==9){++I;b=q.get();if(!b.match(" ")){for(var j=RegExp("^"+b),k=z.top().command_list,x=[],p=k.length;p--;)j.test(k[p])&&x.push(k[p]);if(x.length==1)c.set_command(x[0]);else if(x.length>1)if(I>=2){m(b);c.echo(x.join("\t"));I=0}}return false}else if(b.which==86&&b.ctrlKey){c.oneTime(1,function(){y()});return true}else if(b.which==9&&b.ctrlKey){P.length()>1&&c.focus(false);b.preventDefault()}else if(b.which==34)c.scroll(c.height());
else b.which==33?c.scroll(-c.height()):c.attr({scrollTop:c.attr("scrollHeight")})}}var c=this,O=[],f,r=P.length(),L,R=[],l={name:"",prompt:">",history:true,exit:true,clear:true,enabled:true,login:null,tabcompletion:false,onInit:null,onExit:null,keypress:null,keydown:null};if(d){d.width&&c.width(d.width);d.height&&c.height(d.height);g.extend(l,d)}var D=!l.enabled;if(c.length===0)throw'Sorry, but terminal said that "'+c.selector+'" is not valid selector!';c.ajaxSend(function(b,j){ja.push(j)});if(c.data("terminal"))return c.data("terminal");
f=g("<div>").addClass("terminal-output").appendTo(c);c.addClass("terminal").append("<div/>");g.extend(c,{clear:function(){f.html("");q.set("");O=[];c.attr({scrollTop:0});return c},paused:function(){return D},pause:function(){if(q){c.disable();q.hide()}return c},resume:function(){if(q){c.enable();q.show();y()}return c},cols:function(){return L},rows:function(){return O.length},history:function(){return q.history().data()},next:function(){if(P.length()==1)return c;else{var b=c.offset().top;c.height();
c.scrollTop();var j=c,k=g(window).scrollTop(),x=k+g(window).height(),p=g(j).offset().top;if(p+g(j).height()>=k&&p<=x){P.front().disable();b=P.rotate().enable();j=b.offset().top-50;g("html,body").animate({scrollTop:j},500);return b}else{c.enable();g("html,body").animate({scrollTop:b-50},500);return c}}},focus:function(b){c.oneTime(1,function(){if(P.length()==1)b===false?c.disable():c.enable();else if(b===false)c.next();else{P.front().disable();P.set(c);c.enable()}});return c},enable:function(){L===
A&&c.resize();if(D)if(q){q.enable();D=false}return c},disable:function(){if(q){D=true;q.disable()}return c},enabled:function(){return D},signature:function(){var b=c.cols();b=b<15?null:b<35?0:b<55?1:b<64?2:b<75?3:4;return b!==null?ia[b].join("\n")+"\n":""},version:function(){return"0.4.6"},get_command:function(){return q.get()},insert:function(b){q.insert(b);return c},set_prompt:function(b){t("prompt",b)&&q.prompt(b);return c},set_command:function(b){q.set(b);return c},set_mask:function(b){q.mask(b);
return c},get_output:function(){return g.map(O,function(b,j){return typeof j=="function"?j():j}).get().join("\n")},resize:function(b,j){if(b&&j){c.width(b);c.height(j)}L=i();q.resize(L);var k=f.detach();f.html("");g.each(O,function(x,p){C(typeof p=="function"?p():p)});c.prepend(k);y();return c},echo:function(b){O.push(b);return C(typeof b=="function"?b():b)},error:function(b){c.echo("[[;#f00;]"+b.replace(/\[/g,"&#91;").replace(/\]/g,"&#93;")+"]")},scroll:function(b){var j;if(c.prop){b>c.prop("scrollTop")&&
b>0&&c.prop("scrollTop",0);j=c.prop("scrollTop");c.prop("scrollTop",j+b)}else{b>c.attr("scrollTop")&&b>0&&c.attr("scrollTop",0);j=c.attr("scrollTop");c.attr("scrollTop",j+b)}return c},logout:l.login?function(){for(;z.size()>1;)z.pop();K();return c}:function(){throw"You don't have login function";},token:l.login?function(){var b=l.name;return g.Storage.get("token"+(b?"_"+b:""))}:null,login_name:l.login?function(){var b=l.name;return g.Storage.get("login"+(b?"_"+b:""))}:null,name:function(){return l.name},
push:function(b,j){if(!j.prompt||t("prompt",j.prompt)){if(typeof b=="string")b=T(j.eval,c);z.push(g.extend({eval:b},j));U()}return c},pop:function(b){b!==A&&m(b);if(z.top().name===l.name){if(l.login){K();if(typeof l.onExit=="function")l.onExit(c)}}else{b=z.pop();U();if(typeof b.onExit=="function")b.onExit(c)}return c}});var I=0,s=e(),u;if(a.constructor==String){u=a;a=T(a,c)}else if(a.constructor==Array)throw"You can't use array as eval";else if(typeof a=="object"){for(var o in a)R.push(o);a=function b(j){return function(k){if(k!==
""){k=k.split(/ +/);var x=k[0],p=k.slice(1);k=j[x];var v=typeof k;if(v=="function")k.apply(c,p);else if(v=="object"||v=="string"){p=[];if(v=="object"){for(var w in k)p.push(w);k=b(k)}c.push(k,{prompt:x+">",name:x,command_list:p})}else c.error("Command '"+x+"' Not Found")}}}(a)}else if(typeof a!="function")throw'Unknow object "'+String(a)+'" passed as eval';if(u&&(typeof l.login=="string"||l.login))l.login=function(b){var j=1;return function(k,x,p){c.pause();g.jrpc(u,j++,b,[k,x],function(v){c.resume();
!v.error&&v.result?p(v.result):p(null)},function(v,w){c.resume();c.error("&#91;AJAX&#92; Response: "+w+"\n"+v.responseText)})}}(typeof l.login=="boolean"?"login":l.login);if(t("prompt",l.prompt)){var z=new fa({name:l.name,eval:a,prompt:l.prompt,command_list:R,greetings:l.greetings}),q=c.find(".terminal-output").next().cmd({prompt:l.prompt,history:l.history,width:"100%",keydown:N,keypress:l.keypress?function(b){return l.keypress(b,c)}:null,commands:n});c.livequery(function(){c.resize()});P.append(c);
l.enabled===true?c.focus():c.disable();g(window).resize(c.resize);c.click(function(){c.focus()});c.token&&!c.token()&&c.login_name&&!c.login_name()?J():H();typeof g.fn.init.prototype.mousewheel==="function"&&c.mousewheel(function(b,j){j>0?c.scroll(-40):c.scroll(40);return false},true)}c.data("terminal",c);return c}})(jQuery);
